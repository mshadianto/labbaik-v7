# =============================================================================
# LABBAIK AI v7.5 - Price Aggregation Configuration
# =============================================================================
# Configuration for real-time price aggregation system

# Feature toggles
enabled: true
enable_apis: true
enable_scrapers: true
enable_partner_feeds: true

# API Sources
apis:
  amadeus:
    enabled: true
    cache_ttl_hours: 2
  xotelo:
    enabled: true
    cache_ttl_hours: 1
  makcorps:
    enabled: true
    cache_ttl_hours: 2

# OTA Scrapers
scrapers:
  traveloka:
    enabled: true
    rate_limit_per_minute: 5
    rate_limit_per_hour: 60
    min_delay_seconds: 3
  tiket:
    enabled: true
    rate_limit_per_minute: 5
    rate_limit_per_hour: 60
    min_delay_seconds: 3
  pegipegi:
    enabled: false  # Not implemented yet
    rate_limit_per_minute: 5
    rate_limit_per_hour: 60
    min_delay_seconds: 3

# Partner Price Feeds
partner_feeds:
  enabled: true
  require_approval: true
  auto_approve_trusted: false
  max_feeds_per_partner: 50
  price_validation:
    min_price_idr: 10000000  # 10 juta
    max_price_idr: 500000000  # 500 juta
    min_duration_days: 5
    max_duration_days: 45

# Scheduler - Optimized for Neon Free Tier
# IMPORTANT: Reduce frequency to save compute hours
scheduler:
  enabled: true
  jobs:
    api_refresh:
      enabled: true
      interval_hours: 6        # Was 2, now 6 (save compute)
    ota_scraping:
      enabled: true
      interval_hours: 12       # Was 6, now 12 (save compute)
    partner_sync:
      enabled: true
      interval_hours: 4        # Was 1, now 4 (save compute)
    cache_cleanup:
      enabled: true
      interval_hours: 6        # Was 4, now 6
    history_snapshot:
      enabled: true
      interval_hours: 12       # Was 4, now 12 (save compute)
    data_cleanup:              # NEW: Remove old data
      enabled: true
      interval_hours: 24       # Daily cleanup
      retention_days: 30       # Keep 30 days of data

# Cache Settings - Optimized for Neon Free Tier
# IMPORTANT: Longer TTLs = fewer DB queries = less compute
cache:
  memory:
    enabled: true
    ttl_seconds: 600   # Was 5 min, now 10 min
    max_entries: 1000
  source_specific:
    amadeus_ttl_seconds: 14400   # Was 2h, now 4h
    xotelo_ttl_seconds: 7200     # Was 1h, now 2h
    makcorps_ttl_seconds: 14400  # Was 2h, now 4h
    traveloka_ttl_seconds: 43200 # Was 6h, now 12h
    tiket_ttl_seconds: 43200     # Was 6h, now 12h
    n8n_ttl_seconds: 21600       # NEW: 6h (n8n workflow)
    partner_ttl_seconds: 7200    # Was 1h, now 2h
    demo_ttl_seconds: 86400      # 24 hours (keep)

# Deduplication Settings
deduplication:
  enabled: true
  similarity_threshold: 0.85
  keep_all_sources: true  # Keep one per source for same hotel

# Price Normalization
normalization:
  default_currency: IDR
  sar_to_idr_rate: 4250.0
  normalize_names: true
  normalize_cities: true
  validate_star_ratings: true

# Logging
logging:
  level: INFO
  log_api_calls: true
  log_scraper_calls: true
  log_partner_submissions: true
